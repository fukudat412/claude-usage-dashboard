# Claude Usage Dashboard プロジェクト実装まとめ

## プロジェクト概要
Claude Codeの使用状況を可視化するWebダッシュボードプロジェクト。ローカルのClaude Codeデータを読み取り、様々な角度から使用統計を表示する。

## 実装した主要機能

### 1. MCPツール使用状況の可視化（最新実装）

#### 背景
- **要望**: 「MCPログについて、具体的にどのMCPをどれくらい使われたか見えるようにできたら良いね」
- **目的**: MCPツールの使用頻度や傾向を把握し、最も利用されているツールを可視化

#### 実装内容

##### バックエンド
1. **MCPログ解析機能の拡張** (`src/services/mcpService.js`)
   - `getMcpToolUsageStats()` 関数を追加
   - MCPログファイルから "Calling MCP tool:" パターンを検出
   - ツール別の使用回数、セッション数、初回/最終使用日時を集計
   - 複雑なJSON構造（配列、改行区切り、混在形式）に対応

2. **APIエンドポイントの拡張** (`src/routes/usage.js`)
   - `/api/usage` エンドポイントに `mcpToolUsage` データを追加
   - 並列処理で効率的にデータを取得

##### フロントエンド
1. **MCPツール使用状況コンポーネント** (`src/components/McpToolUsage.js`)
   - 統計サマリー（総呼び出し回数、ユニークツール数、総セッション数）
   - 棒グラフ：上位10ツールの使用頻度
   - 円グラフ：ツール使用比率
   - 最近のセッション一覧
   - 詳細テーブル

2. **スタイリング** (`src/App.css`)
   - レスポンシブデザイン対応
   - カード型UIで統計情報を表示
   - チャートセクションの視覚的な区別

3. **メインアプリへの統合** (`src/App.js`)
   - 新しいタブ「MCPツール使用状況」を追加
   - ルーティングの設定

#### 技術的な課題と解決策
1. **ログフォーマットの多様性**
   - 問題: MCPログが異なる形式（JSON配列、改行区切り等）で保存されている
   - 解決: 段階的なパース処理で各形式に対応

2. **パフォーマンス**
   - 問題: 大量のログファイル読み取りによる遅延
   - 解決: キャッシュサービスの活用、並列処理の実装

### 2. プロジェクト全体の改善

#### Docker対応
- マルチステージビルドによる最適化
- 開発/本番環境の分離（`Dockerfile.dev`）
- Docker Composeによるオーケストレーション

#### パッケージ構成の統合
- フロントエンド/バックエンドの`package.json`を統一
- 依存関係の最適化
- 開発効率の向上

#### モジュラーアーキテクチャ
- サービス層の分離（ビジネスロジック）
- ルート層の整理（APIエンドポイント）
- コンポーネントの再利用性向上

## 実装の流れ

### Phase 1: 要件分析
1. 既存コードベースの調査
2. MCPログ構造の理解
3. データフローの把握

### Phase 2: バックエンド実装
1. MCPログパーサーの作成
2. 統計集計ロジックの実装
3. APIエンドポイントの拡張

### Phase 3: フロントエンド実装
1. Rechartsを使用したチャート実装
2. レスポンシブUIの作成
3. メインアプリケーションへの統合

### Phase 4: テストと最適化
1. 実データでの動作確認
2. パフォーマンスチューニング
3. エラーハンドリングの強化

## 成果

### 定量的成果
- 4種類のMCPツール使用統計を可視化
- 1,000件以上のツール呼び出しを分析可能
- リアルタイムに近い更新（5分キャッシュ）

### 定性的成果
- MCPツールの使用傾向が一目で把握可能
- セッション単位での詳細な分析が可能
- 今後のツール開発の参考データとして活用可能

## 今後の拡張可能性

1. **時系列分析**
   - 日別/週別のツール使用トレンド
   - 使用パターンの変化検出

2. **詳細フィルタリング**
   - プロジェクト別のツール使用状況
   - 期間指定での絞り込み

3. **エクスポート機能**
   - CSV/JSONでの統計データ出力
   - レポート生成機能

4. **アラート機能**
   - 異常な使用パターンの検出
   - 使用量の閾値設定

## 技術スタック
- **バックエンド**: Node.js, Express
- **フロントエンド**: React, Recharts
- **データ処理**: fs-extra, glob
- **スタイリング**: CSS (レスポンシブ対応)
- **コンテナ**: Docker, Docker Compose

## まとめ
このプロジェクトでは、Claude CodeのMCPツール使用状況を可視化する機能を実装しました。複雑なログ形式に対応しながら、直感的で使いやすいUIを提供することで、開発者がツールの使用傾向を把握し、効率的な開発を行えるようサポートしています。