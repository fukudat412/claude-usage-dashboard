# Rustå¯¾å¿œDockeræ§‹æˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

Rustãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’å«ã‚ãŸDockeræ§‹æˆã«ã‚ˆã‚Šã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã¨ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’å¤§å¹…ã«å‰Šæ¸›ã—ã¾ã—ãŸã€‚

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ

### ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚º

| æ§‹æˆ | ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚º | å‰Šæ¸›ç‡ |
|---|---|---|
| å¾“æ¥ç‰ˆï¼ˆNode.jsã®ã¿ï¼‰ | ~180MB | åŸºæº– |
| ã‚¢ãƒ—ãƒ­ãƒ¼ãƒAï¼ˆçµ±åˆç‰ˆï¼‰ | ~120MB | **33%å‰Šæ¸›** |
| ã‚¢ãƒ—ãƒ­ãƒ¼ãƒBï¼ˆãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠï¼‰ | ~115MB | **36%å‰Šæ¸›** |
| - Rustãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å˜ä½“ | ~15MB | **92%å‰Šæ¸›** |
| - Node.jsãƒ—ãƒ­ã‚­ã‚·å˜ä½“ | ~100MB | 44%å‰Šæ¸› |

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

| æ§‹æˆ | ã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ | è² è·æ™‚ | å‰Šæ¸›ç‡ |
|---|---|---|---|
| å¾“æ¥ç‰ˆï¼ˆNode.jsã®ã¿ï¼‰ | ~50-100MB | ~150-200MB | åŸºæº– |
| ã‚¢ãƒ—ãƒ­ãƒ¼ãƒAï¼ˆçµ±åˆç‰ˆï¼‰ | ~20-40MB | ~80-120MB | **60-70%å‰Šæ¸›** |
| ã‚¢ãƒ—ãƒ­ãƒ¼ãƒBï¼ˆãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠï¼‰ | ~15-35MB | ~60-100MB | **70-80%å‰Šæ¸›** |
| - Rustãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å˜ä½“ | ~5-15MB | ~20-40MB | **85-90%å‰Šæ¸›** |
| - Node.jsãƒ—ãƒ­ã‚­ã‚·å˜ä½“ | ~10-20MB | ~40-60MB | 60-80%å‰Šæ¸› |

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“

| å®Ÿè£… | ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ | æ”¹å–„ç‡ |
|---|---|---|
| Node.js | 108ms | åŸºæº– |
| Rust | 39ms | **2.8å€é«˜é€Ÿ** |

## ğŸ— ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒA: çµ±åˆç‰ˆï¼ˆå˜ä¸€ã‚³ãƒ³ãƒ†ãƒŠï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Alpine Linux Container (~120MB)        â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Rust Backend    â”‚ â”‚ Node.js Proxy â”‚ â”‚
â”‚  â”‚ (Port 8080)     â”‚ â”‚ (Port 3001)   â”‚ â”‚
â”‚  â”‚ ~15MB binary    â”‚ â”‚ ~100MB        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â†“                  â†“          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Shared Volume (Claude Data)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒç°¡å˜
- å˜ä¸€ã‚³ãƒ³ãƒ†ãƒŠã§ç®¡ç†ãŒå®¹æ˜“
- ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠç‰ˆã‚ˆã‚Šè‹¥å¹²å¤§ãã„
- å€‹åˆ¥ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ä¸å¯

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒB: ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠç‰ˆï¼ˆæœ€è»½é‡ãƒ»æ¨å¥¨ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Distroless Container     â”‚     â”‚ Alpine Linux Container    â”‚
â”‚                          â”‚     â”‚                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Rust Backend         â”‚ â”‚     â”‚ â”‚ Node.js Proxy         â”‚ â”‚
â”‚ â”‚ (Port 8080)          â”‚â—„â”œâ”€â”€â”€â”€â”€â”¤â–ºâ”‚ (Port 3001)           â”‚ â”‚
â”‚ â”‚ ~15MB total          â”‚ â”‚HTTP â”‚ â”‚ ~100MB total          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      Shared Docker Network & Volumes         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- æœ€å°ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºï¼ˆRust: distrolessä½¿ç”¨ï¼‰
- å„ã‚³ãƒ³ãƒ†ãƒŠã‚’ç‹¬ç«‹ã—ã¦ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯èƒ½
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šï¼ˆæœ€å°æ”»æ’ƒé¢ï¼‰
- å€‹åˆ¥ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå¯èƒ½

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã®ç®¡ç†ãŒå¿…è¦

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

```
claude-usage-dashboard/
â”œâ”€â”€ rust-backend/
â”‚   â””â”€â”€ Dockerfile              # è¶…è»½é‡Rustãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ~15MBï¼‰
â”‚
â”œâ”€â”€ Dockerfile.rust             # çµ±åˆç‰ˆDockerfileï¼ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒAï¼‰
â”œâ”€â”€ Dockerfile.proxy            # Node.jsãƒ—ãƒ­ã‚­ã‚·ç”¨Dockerfile
â”œâ”€â”€ docker-compose.rust.yml     # ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆï¼ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒBï¼‰
â”œâ”€â”€ docker-entrypoint-rust.sh   # çµ±åˆç‰ˆèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ DOCKER_RUST.md              # ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

### æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«

```
â”œâ”€â”€ Dockerfile                  # å¾“æ¥ç‰ˆDockerfileï¼ˆNode.jsã®ã¿ï¼‰
â”œâ”€â”€ Dockerfile.dev              # é–‹ç™ºç‰ˆDockerfile
â””â”€â”€ docker-compose.yml          # å¾“æ¥ç‰ˆdocker-compose
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒA: çµ±åˆç‰ˆ

```bash
# ãƒ“ãƒ«ãƒ‰
docker build -f Dockerfile.rust -t claude-dashboard-rust .

# èµ·å‹•
docker run -d --name claude-dashboard \
  -p 3001:3001 \
  -v ~/.claude:/home/appuser/.claude:ro \
  -v ~/Library/Caches/claude-cli-nodejs:/home/appuser/Library/Caches/claude-cli-nodejs:ro \
  -v ~/Library/Application\ Support/Code:/home/appuser/Library/Application\ Support/Code:ro \
  claude-dashboard-rust

# ãƒ­ã‚°ç¢ºèª
docker logs -f claude-dashboard

# åœæ­¢ãƒ»å‰Šé™¤
docker stop claude-dashboard
docker rm claude-dashboard
```

### ã‚¢ãƒ—ãƒ­ãƒ¼ãƒB: ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠç‰ˆï¼ˆæ¨å¥¨ï¼‰

```bash
# ãƒ“ãƒ«ãƒ‰ã¨èµ·å‹•
docker-compose -f docker-compose.rust.yml up -d

# ãƒ­ã‚°ç¢ºèªï¼ˆå…¨ã‚³ãƒ³ãƒ†ãƒŠï¼‰
docker-compose -f docker-compose.rust.yml logs -f

# ç‰¹å®šã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°
docker-compose -f docker-compose.rust.yml logs -f rust-backend
docker-compose -f docker-compose.rust.yml logs -f node-proxy

# åœæ­¢
docker-compose -f docker-compose.rust.yml down

# å†ãƒ“ãƒ«ãƒ‰
docker-compose -f docker-compose.rust.yml up -d --build
```

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Rustãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒèµ·å‹•ã—ãªã„

```bash
# ãƒ­ã‚°ç¢ºèª
docker-compose -f docker-compose.rust.yml logs rust-backend

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œç¢ºèª
docker-compose -f docker-compose.rust.yml exec rust-backend /bin/sh
# ã‚¨ãƒ©ãƒ¼: distrolessã«ã¯ã‚·ã‚§ãƒ«ãŒãªã„

# ä»£ã‚ã‚Šã«ãƒ“ãƒ«ãƒ€ãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ç¢ºèª
docker run --rm -it rust:1.75-alpine sh
```

### ãƒãƒ¼ãƒˆç«¶åˆ

```bash
# ä½¿ç”¨ä¸­ã®ãƒãƒ¼ãƒˆã‚’ç¢ºèª
lsof -i :3001
lsof -i :8080

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
kill -9 <PID>
```

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†ãƒ“ãƒ«ãƒ‰
docker-compose -f docker-compose.rust.yml build --no-cache

# å¤ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤
docker system prune -a
```

## ğŸ›¡ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### Distroless ã‚¤ãƒ¡ãƒ¼ã‚¸

Rustãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯`gcr.io/distroless/static:nonroot`ã‚’ä½¿ç”¨:

- **æœ€å°æ”»æ’ƒé¢**: ã‚·ã‚§ãƒ«ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãªã—
- **érootãƒ¦ãƒ¼ã‚¶ãƒ¼**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§nonrootãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å®Ÿè¡Œ
- **CVEå‰Šæ¸›**: æœ€å°é™ã®ä¾å­˜é–¢ä¿‚

### Alpine Linux

Node.jsãƒ—ãƒ­ã‚­ã‚·ã¯Alpine Linuxã‚’ä½¿ç”¨:

- **è»½é‡**: ç´„5MBã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ**: å®šæœŸçš„ãªã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
- **érootãƒ¦ãƒ¼ã‚¶ãƒ¼**: å°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å®Ÿè¡Œ

## ğŸ“ˆ ä»Šå¾Œã®æ”¹å–„äºˆå®š

1. **é–‹ç™ºç’°å¢ƒã®Dockeræ§‹æˆ**: ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œ
2. **Kubernetesãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ**: k8sãƒ‡ãƒ—ãƒ­ã‚¤ç”¨è¨­å®š
3. **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ”¹å–„**: ã‚ˆã‚Šè©³ç´°ãªç›£è¦–
4. **ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†**: Prometheusã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼
5. **è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**: è² è·ã«å¿œã˜ãŸã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

## ğŸ“š å‚è€ƒè³‡æ–™

- [Rust Backend Migration](./RUST_MIGRATION.md)
- [Performance Optimizations](./docs/performance-optimizations.md)
- [Distroless Container Images](https://github.com/GoogleContainerTools/distroless)
- [Alpine Linux](https://alpinelinux.org/)
